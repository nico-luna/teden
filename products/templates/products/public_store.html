{% extends "users/base.html" %}
{% block title %}{{ store.name }} - Tienda{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="text-center mb-4">
    {% if store.banner %}
      <img src="{{ store.banner.url }}" class="img-fluid rounded shadow" alt="Banner de la tienda">
    {% endif %}
    <h2 class="mt-3">{{ store.name }}</h2>
    <p class="text-muted">{{ store.description }}</p>
    {% if store.logo %}
      <img src="{{ store.logo.url }}" class="rounded" alt="Logo" width="100">
    {% endif %}
  </div>

  <hr>

  <div class="row">
    {% for product in products %}
      <div class="col-md-3 mb-4">
        <div class="card h-100">
          {% if product.image %}
            <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}">
          {% endif %}
          <div class="card-body">
            <h5 class="card-title">{{ product.name }}</h5>
            <p class="card-text">${{ product.price }}</p>
             {% if product.id %}
  <form method="post" action="{% url 'add_to_cart' product.id %}">
    {% csrf_token %}
    <button type="submit" class="btn btn-success w-100">
      <i class="fas fa-shopping-cart me-1"></i> Agregar al carrito
    </button>
  </form>
{% else %}
  <div class="alert alert-warning">Producto inv√°lido</div>
{% endif %}
<a href="{% url 'stripe_checkout' product.id %}" class="btn btn-dark">
  Pagar con Stripe
</a>

<button 
  class="btn btn-outline-primary w-100 mt-2"
  data-bs-toggle="modal"
  data-bs-target="#productDetailModal"
  data-product-id="{{ product.id }}"
>
  Ver m√°s
</button>

          </div>
        </div>
      </div>
    {% empty %}
      <p class="text-center">Esta tienda a√∫n no tiene productos.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}

<!-- Modal -->
<!-- Modal -->
<div class="modal fade" id="productDetailModal" tabindex="-1" aria-labelledby="productDetailLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productDetailLabel">Detalle del producto</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body text-center">
        <img id="modalProductImage" src="" alt="Imagen del producto" class="img-fluid mb-3 rounded">
        <h3 id="modalProductName"></h3>
        <p id="modalProductDescription" class="text-muted"></p>
        <h4 class="text-success">$<span id="modalProductPrice"></span></h4>
      </div>
    </div>
  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", function () {
  const modal = document.getElementById('productDetailModal');

  modal.addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const productId = button.getAttribute('data-product-id');

    fetch(`/products/detalle/${productId}/`)
      .then(response => response.json())
      .then(data => {
        console.log('üîé Data recibida del producto:', data);  // üëà Log en consola
        document.getElementById('modalProductName').textContent = data.name || 'Sin nombre';
        document.getElementById('modalProductDescription').textContent = data.description || 'Sin descripci√≥n';
        document.getElementById('modalProductPrice').textContent = data.price || '0.00';
        document.getElementById('modalProductImage').src = data.image || 'https://via.placeholder.com/400x200?text=Sin+imagen';
      })
      .catch(error => console.error('Error cargando el producto:', error));
  });
});


</script>
