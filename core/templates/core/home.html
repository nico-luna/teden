{% include "partials/header.html" %}
{% include "partials/login_modal.html" %}
{% include "partials/register_modal.html" %}
{% include "partials/cart_modal.html" %}
{% load static %}
<!-- Hero / Carousel -->
  <div id="mainCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
          <img src="{% static 'banners/image.png' %}" class="d-block w-100" alt="Promo 1">
        <!-- <div class="carousel-caption d-none d-md-block">
          <h5>Hot Sale</h5>
          <p>Hasta 45% OFF y 18 cuotas sin inter√©s</p>
        </div> -->
      </div>
      <div class="carousel-item">
          <img src="{% static 'banners/image2.png' %}" class="d-block w-100" alt="Promo 2">
        <!-- <div class="carousel-caption d-none d-md-block">
          <h5>Promos Exclusivas</h5>
          <p>Solo por tiempo limitado</p>
        </div> -->
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  </div>

  <!-- Categories -->
  <section class="container py-4">
    <div class="row text-center category-icons">
      <div class="col">
        <img src="{% static 'icons/facebook.png' %}" alt="">
        <p>Ofertas</p>
      </div>
      <div class="col">
        <img src="{% static 'icons/facebook.png' %}" alt="">
        <p>Cuotas sin inter√©s</p>
      </div>
      <div class="col">
        <img src="{% static 'icons/facebook.png' %}" alt="">
        <p>Env√≠os gratis</p>
      </div>
      <div class="col">
        <img src="{% static 'icons/facebook.png' %}" alt="">
        <p>Super descuentos</p>
      </div>
    </div>
  </section>


  <!-- Productos destacados -->
   <section class="container my-5">
  <div class="row g-4">
    {% comment %} Reemplazar im√°genes y textos luego {% endcomment %}
    <div class="col-6 col-md-3 col-lg-2">
      <div class="category-box text-center">
        <img src="{% static 'banners/categorias/celulares.png' %}" alt="Celulares" class="img-fluid mb-2">
        <h6 class="fw-bold">Celulares</h6>
        <div class="discount">Hasta 35% OFF</div>
        <div class="cuotas">12 cuotas sin inter√©s</div>
      </div>
    </div>

    <div class="col-6 col-md-3 col-lg-2">
      <div class="category-box text-center">
        <img src="{% static 'banners/categorias/televisores.png' %}" alt="Televisores" class="img-fluid mb-2">
        <h6 class="fw-bold">Televisores</h6>
        <div class="discount">Hasta 35% OFF</div>
        <div class="cuotas">18 cuotas sin inter√©s</div>
      </div>
    </div>

    <!-- Agreg√° m√°s categor√≠as igual... -->
  </div>
</section>
  <!-- Publicidad vertical -->
  <div class="position-fixed end-0 top-0 bg-dark text-white text-center py-2 px-3" style="writing-mode: vertical-rl; height: 100vh; z-index: 1050;">
    Publicidad
  </div>


{% block content %}
<div class="container py-4">
  <h2 class="mb-4">Cat√°logo de Productos</h2>
  <div class="row g-4">
    {% for producto in productos %}
      <div class="col-12 col-sm-6 col-md-4 col-lg-3">
        <div class="card h-100 shadow-sm">
          {% if producto.image %}
            <img src="{{ producto.image.url }}"
                 class="card-img-top"
                 style="height:200px; object-fit:cover;"
                 alt="{{ producto.name }}">
          {% else %}
            <div class="bg-light d-flex align-items-center justify-content-center" style="height:200px;">
              Sin imagen
            </div>
          {% endif %}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ producto.name }}</h5>
            <p class="card-text text-truncate" style="max-height:3.5em; overflow:hidden;">
              {{ producto.description }}
            </p>
            <div class="mt-auto">
              <p class="h5 text-success mb-3">${{ producto.price }}</p>
              <a href="{% url 'stripe_checkout' producto.id %}" class="btn btn-dark">
  Pagar con Stripe
</a>
<a href="{% url 'pagar_con_mercadopago' producto.id %}" class="btn btn-primary">
  Pagar con MercadoPago
</a>
              <form method="post" action="{% url 'add_to_cart' producto.id %}">
                {% csrf_token %}
                <button type="submit"
                        class="btn btn-success w-100">
                  <i class="fas fa-shopping-cart me-1"></i>  
                  Agregar al carrito
                </button>
              </form>
              

              <button 
  class="btn btn-outline-primary" 
  data-bs-toggle="modal" 
  data-bs-target="#productDetailModal" 
  data-product-id="{{ producto.id }}"
>
  Ver m√°s
</button>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
<!-- Modal -->
<div class="modal fade" id="productDetailModal" tabindex="-1" aria-labelledby="productDetailLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productDetailLabel">Detalle del producto</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body text-center">
        <img id="modalProductImage" src="" alt="Imagen del producto" class="img-fluid mb-3 rounded">
        <h3 id="modalProductName"></h3>
        <p id="modalProductDescription" class="text-muted"></p>
        <h4 class="text-success">$<span id="modalProductPrice"></span></h4>
        <hr>
        <div id="modalProductRating" class="mb-3 text-warning fw-bold"></div>
        <div id="modalProductReviews" class="text-start mt-3">
          <h5>Rese√±as de clientes</h5>
          <div id="reviewsContainer"></div>
        </div>
      </div>
    </div>
  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", function () {
  const modal = document.getElementById('productDetailModal');

  modal.addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const productId = button.getAttribute('data-product-id');

    fetch(`/products/detalle/${productId}/`)
      .then(response => response.json())
      .then(data => {
        console.log('üîé Data recibida del producto:', data);

        document.getElementById('modalProductName').textContent = data.name || 'Sin nombre';
        document.getElementById('modalProductDescription').textContent = data.description || 'Sin descripci√≥n';
        document.getElementById('modalProductPrice').textContent = data.price || '0.00';
        document.getElementById('modalProductImage').src = data.image || 'https://via.placeholder.com/400x200?text=Sin+imagen';
        
        // Promedio de valoraciones
        document.getElementById('modalProductRating').textContent = data.avg_rating 
          ? `‚≠ê ${data.avg_rating} / 5` 
          : '‚≠ê Sin valoraciones';

        // Cargar rese√±as
        const reviewsContainer = document.getElementById('reviewsContainer');
        reviewsContainer.innerHTML = '';

        if (data.reviews && data.reviews.length > 0) {
          data.reviews.forEach(review => {
            const reviewDiv = document.createElement('div');
            reviewDiv.className = 'border rounded p-3 mb-2';
            reviewDiv.innerHTML = `
              <strong>${review.user}</strong> - ‚≠ê ${review.rating}/5<br>
              <small class="text-muted">${review.date}</small>
              <p class="mb-0">${review.comment}</p>
            `;
            reviewsContainer.appendChild(reviewDiv);
          });
        } else {
          reviewsContainer.innerHTML = '<p class="text-muted">Sin rese√±as a√∫n.</p>';
        }
      })
      .catch(error => console.error('‚ùå Error cargando el producto:', error));
  });
});
</script>

{% if show_register_modal %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const modal = new bootstrap.Modal(document.getElementById('registerModal'));
    modal.show();
  });
</script>
{% endif %}

